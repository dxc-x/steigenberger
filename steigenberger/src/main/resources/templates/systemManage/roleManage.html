<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<script src="../js/jquery-1.11.1.min.js"></script>
<script src="../js/pie-chart.js" type="text/javascript"></script>
<link href="../assets/bootstrap.css" rel="stylesheet">
<link  href="../assets/vendor/toastr/toastr.min.css" rel="stylesheet"/>
<script src="../assets/vendor/toastr/toastr.min.js"></script>
 
</head> 
<body>
<div id="accordion-magical-coder-auto-id-1564364871048" class="panel-group" role="tablist" aria-multiselectable="true" style="margin-top: 20px; margin-left: 25px; margin-right: 25px;">
    <div class="panel panel-default">
        <div class="panel-heading" role="tab">
            <h4 class="panel-title">
                <a role="button"   href="#collapseOne-magical-coder-auto-id-1564364870633" aria-expanded="false" class="collapsed">角色查询 Role of query</a>
            </h4>
        </div>
        <div  class="panel-collapse collapse in" role="tabpanel" aria-expanded="false" >
            <div class="panel-body" style="height: 107px;">
				<form action="">
	                <!--  <div class="row">   
						<div class="col-md-3 col-xs-3"> 状态 status </div>
					</div> -->
					<div class="row"> 
	                   <div class="col-xs-3">
	                        <select class="form-control  searchVal2" name="" th:value="${role?.isActive}">
	                        		<option value="2">全选</option>
									<option value="1" th:selected="${role?.isActive }==1">启用</option>
									<option value="0" th:selected="${role?.isActive }==0">停用</option>
							</select>
	                    </div>
	                    <div class="col-md-3 col-xs-3"><button type="button" class="btn btn-primary" style="margin-top: 0px; margin-right: 15px;" id="btn_select">查询select</button> </div>
	                </div>
                </form>
                
            </div>
        </div>
    </div>
    <div class="panel panel-default">
        <div class="panel-heading" role="tab">
            <h4 class="panel-title">
                <a class="" role="button" data-toggle="collapse"  href="#collapseTwo-magical-coder-auto-id-1564364869430" aria-expanded="true">角色列表 Role list</a>
            </h4>
        </div>
        <div  class="panel-collapse collapse in" role="tabpanel" aria-expanded="true">
            <div class="panel-body" style="height: auto;" mc-ace="~">

                <div class="table-responsive">
                    <table class="table">
                        <thead>
					<tr>
						<th style="width: 10%;">编号</th>
						<th style="width: 50%;">角色名称 Role name</th>
						<th style="width: 25%;">状态 Status</th>
						<th style="width: 15%;">操作 Operation</th>
					</tr>
				</thead>
				<tbody>
					<th:block th:if="${datas.content != null}">
						<tr th:each="role,roleStart: ${datas.content}">
							<td th:text="${roleStart.count}">560001</td>
							<td th:text="${role?.name}" value="${role?.name}">Bangalore</td>
							<td th:text="${role.isActive>0?'启用' :'禁用'}" th:style="${role.isActive>0?'color:green' :'color:red'}" >560001</td>
							<td>
                                <!-- <button type="button" class="btn btn-primary btn-lg update" data-toggle="modal" th:title="${role.id}"
                                data-target="#magicalcoderMyModal-magical-coder-auto-id-1564365300654" style="font-size: 13px; padding: 3px 10px;">
                                    		编辑 edit
                                </button> -->
                                <button type="button" class="btn btn-primary btn-lg update_auth"  th:title="${role.id}"
									data-target="#magicalcoderMyModal-magical-coder-auto-id-1564365300654" style="font-size: 13px; padding: 3px 10px;">
                                    		编辑 edit
                                </button>
                                
							</td>
						</tr>
					</th:block>
				</tbody>
                    </table>
                </div>
				<div th:include="page :: pager" th:remove="tag"></div>  
                
            </div>
        </div>
    </div>
</div>

<script>
	var ctxPath  = [[@{/}]];
		$(function(){
    	  $(".update").on("click",function(){
    		 	var id= $(this).attr("title");
	  			var rolename=$(this).parent().siblings("td:eq(1)").text();
	  			var isActive=$(this).parent().siblings("td:eq(2)").text();
    		 	
	  			$(".roleform .id").val(id);
	  			$(".roleform .name").val(rolename);
	  			if(isActive=="启用"){
	  				$(".roleform .isActive").val(1); 
	  			}else{
	  				$(".roleform .isActive").val(0);
	  			}
    	  });
    	  
    	  $(".roleform").on("submit",function(e){
    		  e.preventDefault();
    		  var url=ctxPath+"role/update";
    		  var id=null;
    		  if($(".roleform .id").val()!=null){
    			 id=parseInt($(".roleform .id").val());
    		     }    		  
    		  var name=$(".roleform .name").val(); 
    		  var isActive=$(".roleform .isActive").val();
    		
    		  var data={
    				  id:id,
    				  name:name,
    				  isActive:isActive
    				  }
    		  $.ajax(
    		      		{type:"POST",
    		      		   url: url,
    		      		   contentType:'application/json;charset=utf-8',
    		      		   data:JSON.stringify(data),
    		      		   success: function(data){	  
    		      			 showmsg(data);	     
    		      		   },
    		      		  error: function (xhr) {
    		      	        console.log(xhr);
    		      	    } });
    	     });
    	  
	    	  $("#btn_select").on("click",function(){
	    		  var name=$(".searchVal1").val();
	    	      var isActive=$(".searchVal2").val();
	    	      window.location.href = ctxPath+"role/index?isActive="+isActive; 
	    	      return false;
	          });
	    	  $(".update_auth").on("click",function(){
	    		  var id= $(this).attr("title");
	    	      window.location.href = ctxPath+"role/authorization?id="+id; 
	    	      return false;
	          });
          });
      

		function showmsg(data){
	    	  if(data.status>200){
			    	toastr.warning(data.msg);  
			       }
			    else{
			    	toastr.success(data.msg);
			      }
			 setTimeout(function(){
				window.location.reload();	      				 
			    },1000);
	      }
	      
      toastr.options = {  
   	        closeButton: false,  
   	        debug: false,  
   	        progressBar: false,  
   	        positionClass: "toast-bottom-center",  
   	        onclick: null,  
   	        showDuration: "300",  
   	        hideDuration: "1000",  
   	        timeOut: "2000",  
   	        extendedTimeOut: "1000",  
   	        showEasing: "swing",  
   	        hideEasing: "linear",  
   	        showMethod: "fadeIn",  
   	        hideMethod: "fadeOut"  
   	    }; 
	      
</script>	
</body>
</html>