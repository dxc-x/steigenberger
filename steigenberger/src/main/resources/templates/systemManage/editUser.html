<!DOCTYPE HTML>
<html lang="zh-cn" xmlns:th="http://www.thymeleaf.org">

<head>
<title>Home</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="keywords" content="" />
<script type="application/x-javascript"> addEventListener("load", function() { setTimeout(hideURLbar, 0); }, false); function hideURLbar(){ window.scrollTo(0,1); } </script>

<!-- Bootstrap Core CSS -->
<link href="../css/bootstrap.css" rel='stylesheet' type='text/css' />

<!-- Custom CSS -->
<link href="../css/style.css" rel='stylesheet' type='text/css' />

<!-- font-awesome icons CSS -->
<link href="../css/font-awesome.css" rel="stylesheet"> 
<!-- //font-awesome icons CSS-->

<!-- side nav css file -->
<link href='../css/SidebarNav.min.css' media='all' rel='stylesheet' type='text/css'/>
<!-- //side nav css file -->
 
 <!-- js-->
<script src="../js/jquery-1.11.1.min.js"></script>
<script src="../js/modernizr.custom.js"></script>

<!--webfonts-->
<link href="http://fonts.googleapis.com/css?family=PT+Sans:400,400i,700,700i&amp;subset=cyrillic,cyrillic-ext,latin-ext" rel="stylesheet">
<!--//webfonts--> 

<!-- chart -->
<script src="../js/Chart.js"></script>
<!-- //chart -->

<!-- Metis Menu -->
<script src="../js/metisMenu.min.js"></script>
<script src="../js/custom.js"></script>
<link href="../css/custom.css" rel="stylesheet">
<!--//Metis Menu -->

<!--pie-chart --><!-- index page sales reviews visitors pie chart -->
<script src="../js/pie-chart.js" type="text/javascript"></script>
<link href="../assets/drag/bootstrap-3.3.7/bootstrap/css/bootstrap.css" rel="stylesheet">
 
</head> 
<body class="cbp-spmenu-push">
<div class="sticky-header header-section " th:replace="head::head">	</div>
<div class="cbp-spmenu cbp-spmenu-vertical cbp-spmenu-left" id="cbp-spmenu-s1" th:replace="menu::menu">	</div>	
	
<!-- main content start-->
<div id="page-wrapper">
	<div class="main-page" style=" margin-left: 3%; margin-right: 3%;">
	    <div class="forms">
	        <div class="form-grids row widget-shadow" data-example-id="basic-forms">
	            <div class="form-title">
	                <h4>编辑用户信息</h4>
	            </div>
	            <div class="form-body">
	                <form class="form" onsubmit="return false" action="##" method="post">
	                	<input type="text" class="form-control id hidden" id="id" th:value="${map?.user.id}">
	                    <div class="form-group">
	                        <label for="exampleInputEmail1">申请人姓名</label>
	                         <input type="text" class="form-control userName" id="userName" name="userName" th:value="${map?.user.userName}" required/>
	                    </div>
	                    
	                    <div class="form-group">
	                        <label for="exampleInputEmail1">申请人邮箱</label>
	                         <input type="text" class="form-control" id="userMail" name="userMail" th:value="${map?.user.userMail}" required/>
	                    </div>
	                    
	                    <div class="form-group">
	                        <p class="help-block">
	                            	请填写邮箱（例：zhangsan@carrier.com）.
	                        </p>
	                    </div>
	                    <div class="form-group">
	                        <label for="exampleInputEmail1">申请人域账号</label>
	                         <input type="text" class="form-control" id="userIdentity" name="userIdentity" th:value="${map?.user.userIdentity}" required/>
	                    </div>
	                    <div class="form-group">
	                        <label >请选择角色</label>
	                        <div class="row">
							     <div  class="checkbox checkbox-inline checkbox-success"  th:each="role,roleStart:${map?.rolesAll}" >                                          				   				       
				               		<div class="col-md-6 col-xs-6"    style="height:60px;">               
									     <input type="checkbox"  class="send  styled"   th:id="${role.id}"   th:value="${role.id}"  th:if="${role.selected==true}"   th:title="${role.id}" checked>
									     <input type="checkbox"  class="send  styled"   th:id="${role.id}"   th:value="${role.id}"  th:if="${role.selected!=true}"   th:title="${role.id}">
			                     		 <label   th:text="${role.name}" ></label>
				                     </div>                         
							   </div>
							</div>
	                        
	                    </div>
	                    <div class="form-group">
	                        <label >请选择区域</label>
	                        <select class="form-control" id="region"  th:value="${map?.user.region}">
	                        	<option  th:each="office:${officeList}" th:value="${office.code}" th:if="${map?.user.region==office?.code}" selected="selected" th:text="${office.name}"></option>
	                        </select>
	                    </div>
	                    <div class="form-group">
	                        <label >状态</label>
	                        <select class="form-control  isActive" id="isActive" th:value="${map?.user.isActive}">
								<option value="1" th:selected="${map?.user.isActive}==1">启用</option>
								<option value="0" th:selected="${map?.user.isActive}==0">停用</option>
							</select>
	                    </div>
	                    <button type="submit"   class="submit btn btn-primary pull-right " style="font-size: 15px; padding: 3px 10px;float:right;margin-right:15px">保存</button>
						<button type="button" class="btn btn-primary pull-right" id="btn_back" style="font-size: 15px; padding: 3px 10px;float:right;margin-right:3px">返回</button>
	                </form>
	            </div>
	        </div>
	    </div>
	</div>
</div>

	<!-- new added graphs chart js-->
<div id="footer" class="container" th:replace="foot::foot"></div>
    
	
<script src="../js/classie.js"></script>
<script>
	var menuLeft = document.getElementById( 'cbp-spmenu-s1' ),
		showLeftPush = document.getElementById( 'showLeftPush' ),
		body = document.body;
		
	showLeftPush.onclick = function() {
		classie.toggle( this, 'active' );
		classie.toggle( body, 'cbp-spmenu-push-toright' );
		classie.toggle( menuLeft, 'cbp-spmenu-open' );
		disableOther( 'showLeftPush' );
	};
	

	function disableOther( button ) {
		if( button !== 'showLeftPush' ) {
			classie.toggle( showLeftPush, 'disabled' );
		}
	}
	
	var ctxPath  = [[@{/}]];
		$(".form").on("submit",function(e){
	    	e.preventDefault();
	    	var rid = new Array();
	    	var val=$(".checkbox-inline :checked");
	    	val.each(function(i){
	    		rid[i] = $(this).val();
			  });   	

	    	var rids = rid.join(",");
	    	var userId = $("#id").val();    
	    	var userName = $("#userName").val();    
	    	var userMail = $("#userMail").val();    
	    	var userIdentity = $("#userIdentity").val();
	    	var region = $("#region").val();  
	    	var isActive = $("#isActive").val();    
	    	
	    	userId=parseInt(userId);
	    	var data={id:userId,userName:userName,userMaol:userMail,userIdentity:userIdentity,rolesName:rids,region:region,isActive:isActive};
	    	console.log(data);
	    	console.log(typeof rids);
	    	 
	    	$.ajax({  type:"post",
		      		   url: ctxPath+'user/update',
		      		   contentType:'application/json;charset=utf-8',
		      		   data:JSON.stringify(data),
		      		   success: function(data){	     	      			
		       		     if(data.status>200){
	 	       		    	toastr.warning(data.msg);  
	 	       		    setTimeout(function(){
	 	       		    	window.location.reload();
	 	       		     },2000);
	 	       		       }
	 	       		    else{
	 	       		    	toastr.success(data.msg);
	 	       		       setTimeout(function(){
	 	       		    	window.location.href = ctxPath+"/user/index";
	 	       		        },2000);
	 	       		      } 				 
		      		}});
	    	
	       	});
		
		 $(".form #btn_back").on("click",function(e){
			 window.location.href = ctxPath+"/user/index";
		    });
		      
</script>	
<!--scrolling js-->
<script src="../js/jquery.nicescroll.js"></script>
<script src="../js/scripts.js"></script>
<!--//scrolling js-->

<!-- side nav js -->
<script src='../js/SidebarNav.min.js' type='text/javascript'></script>
<script>
     $('.sidebar-menu').SidebarNav()
   </script>	
<script src="../js/SimpleChart.js"></script>
<script src="../js/bootstrap.js"> </script>	
   
<!--  js -->  
</body>
</html>