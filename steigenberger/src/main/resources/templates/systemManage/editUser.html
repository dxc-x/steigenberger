<!DOCTYPE HTML>
<html lang="zh-cn" xmlns:th="http://www.thymeleaf.org">
<head>
<script src="../js/jquery-1.11.1.min.js"></script>
<link href="../assets/drag/bootstrap-3.3.7/bootstrap/css/bootstrap.css" rel="stylesheet">
<script src="../js/pie-chart.js" type="text/javascript"></script>
<link href="../css/style.css" rel='stylesheet' type='text/css' />
<link  href="../assets/vendor/toastr/toastr.min.css" rel="stylesheet"/>
<script src="../assets/vendor/toastr/toastr.min.js"></script>

<script type="text/javascript">
	var ctxPath  = [[@{/}]];
	$(function(){
		$(".form").on("submit",function(e){
	    	var rid = new Array();
	    	var val=$(".checkbox-inline :checked");
	    	val.each(function(i){
	    		rid[i] = $(this).val();
			  });   	

	    	var rids = rid.join(",");
	    	var userId = $("#id").val();    
	    	var userName = $("#userName").val();    
	    	var userMail = $("#userMail").val();    
	    	var userIdentity = $("#userIdentity").val();
	    	var regionCode = $("#region").val();  
	    	var isActive = $("#isActive").val();    
	    	
	    	userId=parseInt(userId);
	    	var data={id:userId,userName:userName,userMail:userMail,userIdentity:userIdentity,rolesName:rids,region:{code:regionCode},isActive:isActive};
	    	console.log(data);
	    	console.log(typeof rids);
	    	 
	    	$.ajax({  type:"post",
		      		   url: ctxPath+'user/update',
		      		   contentType:'application/json;charset=utf-8',
		      		   data:JSON.stringify(data),
		      		   async:false,
		      		   success: function(data){	     	      			
		       		     if(data.status>200){
	 	       		    	toastr.warning(data.msg);  
	 	       		    setTimeout(function(){
	 	       		    	window.location.reload();
	 	       		     },2000);
	 	       		       }
	 	       		    else{
	 	       		    	toastr.success(data.msg);
	 	       		       setTimeout(function(){
	 	       		    	window.location.href = ctxPath+"/user/index";
	 	       		        },2000);
	 	       		      } 				 
		      		}});
	    	
	       	});
		
		 $(".form #btn_back").on("click",function(e){
			 window.location.href = ctxPath+"/user/index";
		 });
	})
 </script>
</head> 
<body>
	<div id="accordion-magical-coder-auto-id-1564457277922" class="panel-group" role="tablist" aria-multiselectable="true" style="margin-top: 20px; margin-left: 25px; margin-right: 25px;">
	        <div class="form-grids row widget-shadow" data-example-id="basic-forms">
	            <div class="form-title">
	                <h4>编辑用户信息</h4>
	            </div>
	            <div class="form-body">
	                <form class="form" >
	                	<input type="text" class="form-control id hidden" id="id" th:value="${map?.user.id}">
	                    <div class="form-group">
	                        <label for="exampleInputEmail1">申请人姓名</label>
	                         <input type="text" class="form-control userName" id="userName" name="userName" th:value="${map?.user.userName}" required/>
	                    </div>
	                    
	                    <div class="form-group">
	                        <label for="exampleInputEmail1">申请人邮箱</label>
	                         <input type="text" class="form-control" id="userMail" name="userMail" th:value="${map?.user.userMail}" required/>
	                    </div>
	                    
	                    <div class="form-group">
	                        <p class="help-block">
	                            	请填写邮箱（例：zhangsan@carrier.com）.
	                        </p>
	                    </div>
	                    <div class="form-group">
	                        <label for="exampleInputEmail1">申请人域账号</label>
	                         <input type="text" class="form-control" id="userIdentity" name="userIdentity" th:value="${map?.user.userIdentity}" required/>
	                    </div>
	                    <div class="form-group">
	                        <label >请选择角色</label>
	                        <div class="row" style="width:100%; height:200px; border:solid 1px #CCC;">
							     <div  class="checkbox checkbox-inline checkbox-success"  th:each="role,roleStart:${map?.rolesAll}" >                                          				   				       
				               		<div style="height:50px;width:150px;padding: 3px 10px;float:left;margin-left:15px">               
									     <input type="checkbox"  class="send  styled"   th:id="${role.id}"   th:value="${role.id}"  th:if="${role.selected==true}"   th:title="${role.id}" checked >
									     <input type="checkbox"  class="send  styled"   th:id="${role.id}"   th:value="${role.id}"  th:if="${role.selected!=true}"   th:title="${role.id}">
			                     		 <label   th:text="${role.name}" ></label>
				                     </div>                         
							   </div>
							</div>
	                        
	                    </div>
	                    <div class="form-group">
	                        <label >请选择区域</label>
	                        <select class="form-control" id="region"  th:value="${map?.user.region?.code}" >
	                        		<option  th:each="office:${officeList}" th:value="${office.code}"  th:text="${office.name}" th:selected="${map?.user.region?.code==office?.code}"></option>
								</select>
	                    </div>
	                    <div class="form-group" >
	                        <label >状态</label>
	                        <select class="form-control  isActive" id="isActive" th:value="${map?.user.isActive}">
								<option value="1" th:selected="${map?.user.isActive}==1">启用</option>
								<option value="0" th:selected="${map?.user.isActive}==0">停用</option>
							</select>
	                    </div>
	                    
	                    <div class="form-group text-righ" style="padding: 3px 10px;margin-top:55px;">						    
						     <button type="submit"   class="submit btn btn-primary pull-right " style="font-size: 15px; padding: 3px 10px;float:right;margin-right:15px">保存</button>
							<button type="button" class="btn btn-primary pull-right" id="btn_back" style="font-size: 15px; padding: 3px 10px ;float:right;margin-right:3px">返回</button>
						 </div>
	                </form>
	            </div>
	        </div>
			<div class="forms"></div>
	</div>
</body>
</html>